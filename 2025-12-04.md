# 2025年12月4日学习记录

## 今日学习重点：C语言文件操作与命令行参数

### 学习内容概览

今日主要学习C语言中的文件操作函数和命令行参数处理，这是Linux系统编程的重要基础。

## 一、命令行参数处理

### 1.1 main函数参数
- `argc` - 参数个数（包括程序名本身）
- `argv` - 参数数组，`argv[0]`为程序名

### 1.2 示例代码分析

```c:%2Fhome%2Fembedded-learning%2F2025-12-04%2Fcode%2Farg.c
#include <stdio.h>

int main(int argc, char **argv) {
  int l = 0;
  int last = 0;
  printf("argc = %d\n", argc);
  for (int i = 0; i < argc; i++) {
    printf("argv[%d] = %s\n", i, argv[i]);
  }

  FILE *fp = fopen(argv[1],"r");
  if( fp == NULL ){
    perror("文件打开失败！\n");
    return -1;
  }

  int ch = 0;
  while( EOF != (ch = fgetc(fp))){
    if( ch == '\n' ){
      l++;
    }
    last = ch;
  }
  if(last != '\n' && last != 0){
    l++;
  }
  fclose(fp);
  printf("行数为%d\n",l);
  return 0;
}
```

**功能说明：**
- 读取命令行参数并显示
- 打开第一个参数指定的文件
- 统计文件行数（正确处理最后一行无换行符的情况）

## 二、标准IO文件操作

### 2.1 文件打开与关闭

```c
FILE *fp = fopen("filename", "mode");
int result = fclose(fp);
```

**常用文件打开模式：**
- `"r"` - 只读
- `"w"` - 只写（创建或清空）
- `"a"` - 追加
- `"r+"` - 读写

### 2.2 字符读写函数

```c
int ch = fgetc(FILE *stream);    // 读取一个字符
int result = fputc(int c, FILE *stream); // 写入一个字符
```

### 2.3 示例代码分析

```c:%2Fhome%2Fembedded-learning%2F2025-12-04%2Fcode%2Ffopen.c
#include <stdio.h>
#include <errno.h>
#include <string.h>

int main(){
    // 1.以只读形式打开文件
    FILE* fp = fopen("1.c","r");
    if( NULL == fp ){
        perror("文件打开失败!\n");
        printf("错误信息为%s\n",strerror(errno));
        return -1;
    }else{
        printf("文件打开成功!\n");
    }
    
    // 2.从标准输入读取字符
    int ch = 0;
    while(EOF != (ch = fgetc(stdin))){
        printf("读取到的字符为：%c\n",ch);
        if(ch == 'q'){
            break;
        }
    }
    
    // 3.向标准输出写入字符
    int ich = fputc('w',stdout);
    printf("读取到的字符为：%c\n",ich);
    
    // 4.关闭文件
    int c = fclose(fp);
    if( c == EOF ){
        printf("文件关闭失败!\n");
        return -1;
    }
    printf("文件关闭成功!\n");
    return 0;
}
```

## 三、重要概念解析

### 3.1 错误处理
- `perror()` - 打印系统错误信息
- `strerror(errno)` - 获取错误描述字符串
- 检查文件指针是否为`NULL`

### 3.2 标准流
- `stdin` - 标准输入（键盘）
- `stdout` - 标准输出（屏幕）
- `stderr` - 标准错误输出

### 3.3 文件结尾判断
- `EOF` - 文件结束标志（通常为-1）
- 正确判断文件结束的方法

## 四、实践练习

### 练习1：文件复制工具
编写一个程序，实现文件复制功能：
```bash
./copy source.txt destination.txt
```

### 练习2：行数统计增强版
改进行数统计程序，支持：
- 统计字符数、单词数、行数
- 支持多个文件同时统计

### 练习3：简单的文本编辑器
实现基本的文本编辑功能：
- 读取文件内容
- 支持插入、删除操作
- 保存修改后的文件

## 五、常见问题与解决方案

### 5.1 文件打开失败的可能原因
1. 文件不存在
2. 权限不足
3. 路径错误
4. 文件被其他进程占用

### 5.2 行数统计的边界情况
- 空文件（0行）
- 只有一行且无换行符
- 文件以换行符结尾

### 5.3 内存泄漏预防
- 确保每个`fopen`都有对应的`fclose`
- 在错误处理分支也要关闭文件

## 六、学习总结

### 掌握要点
- ✅ 命令行参数的处理方法
- ✅ 文件打开、读取、写入、关闭的基本操作
- ✅ 标准输入输出的使用
- ✅ 错误处理机制

### 下一步学习建议
1. 学习二进制文件操作（`fread`/`fwrite`）
2. 掌握文件定位函数（`fseek`/`ftell`）
3. 学习文件系统IO（`open`/`read`/`write`）
4. 实践文件操作相关的项目

---

**今日收获：** 掌握了C语言文件操作的基础知识，能够编写简单的文件处理程序，为后续的系统编程学习打下坚实基础。